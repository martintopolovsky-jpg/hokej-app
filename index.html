<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Základná zostava</title>
<style>
body { font-family: sans-serif; display: flex; gap: 20px; padding: 20px; }
#players, #lineup { flex: 1; }
h3 { margin-top: 0; }
.player { padding: 5px 10px; margin: 5px 0; background: #eee; cursor: pointer; border-radius: 4px; }
.lineup { display: grid; gap: 10px; margin-top: 10px; }
.obranca-grid { grid-template-columns: repeat(4, 1fr); grid-auto-rows: 50px; }
.utocnik-grid { grid-template-columns: repeat(4, 1fr); grid-auto-rows: 50px; }
.slot { border: 1px dashed #999; display: flex; align-items: center; justify-content: center; border-radius: 4px; background: #f9f9f9; }
.slot.filled { background: #b3e5fc; border: 1px solid #039be5; }
</style>
</head>
<body>

<div id="players">
    <h3>Obrancovia</h3>
    <div id="defenders">
        {% for p in players %}
            {% if p.position == 'obranca' and p.in_lineup == 0 %}
                <div class="player" onclick="addToLineup({{p.id}}, 'obranca', this)">
                    {{p.name}}
                </div>
            {% endif %}
        {% endfor %}
    </div>

    <h3>Útočníci</h3>
    <div id="forwards">
        {% for p in players %}
            {% if p.position == 'utocnik' and p.in_lineup == 0 %}
                <div class="player" onclick="addToLineup({{p.id}}, 'utocnik', this)">
                    {{p.name}}
                </div>
            {% endif %}
        {% endfor %}
    </div>
</div>

<div id="lineup">
    <h3>Základná zostava</h3>
    <div>Obrancovia</div>
    <div class="lineup obranca-grid" id="defenderSlots">
        {% set def_index = 0 %}
        {% for p in players %}
            {% if p.position == 'obranca' and p.in_lineup == 1 %}
                <div class="slot filled" id="def_{{def_index}}">{{p.name}}</div>
                {% set def_index = def_index + 1 %}
            {% endif %}
        {% endfor %}
        {% for i in def_index..7 %}
            <div class="slot" id="def_{{i}}"></div>
        {% endfor %}
    </div>

    <div>Útočníci</div>
    <div class="lineup utocnik-grid" id="forwardSlots">
        {% set att_index = 0 %}
        {% for p in players %}
            {% if p.position == 'utocnik' and p.in_lineup == 1 %}
                <div class="slot filled" id="att_{{att_index}}">{{p.name}}</div>
                {% set att_index = att_index + 1 %}
            {% endif %}
        {% endfor %}
        {% for i in att_index..11 %}
            <div class="slot" id="att_{{i}}"></div>
        {% endfor %}
    </div>
</div>

<script>
function addToLineup(playerId, position, elem) {
    let slots = position === 'obranca' ? document.querySelectorAll('#defenderSlots .slot') 
                                      : document.querySelectorAll('#forwardSlots .slot');
    for(let slot of slots) {
        if(!slot.classList.contains('filled')) {
            slot.textContent = elem.textContent;
            slot.classList.add('filled');

            // Uloženie do DB cez fetch
            fetch('/toggle_lineup', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: 'id=' + playerId
            });

            // Odstrániť zo zoznamu ľavého stĺpca
            elem.remove();
            break;
        }
    }
}
</script>

</body>
</html>
